version: "3.8"

services:
  # Next.js Application (Production)
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: chitchat-app-prod
    restart: always
    ports:
      - "1630:1630"
    environment:
      # MongoDB - Use your production MongoDB URI
      MONGODB_URI: ${MONGODB_URI}

      # NextAuth
      NEXTAUTH_SECRET: ${NEXTAUTH_SECRET}
      NEXTAUTH_URL: ${NEXTAUTH_URL}

      # Server URL
      NEXT_PUBLIC_SERVER_URL: ${NEXT_PUBLIC_SERVER_URL}

      # Admin
      ADMIN_EMAILS: ${ADMIN_EMAILS}

      # Passkey
      ALLOWED_PASSKEY_DOMAINS: ${ALLOWED_PASSKEY_DOMAINS}

      # Email
      SMTP_HOST: ${SMTP_HOST}
      SMTP_PORT: ${SMTP_PORT}
      SMTP_SECURE: ${SMTP_SECURE}
      SMTP_USER: ${SMTP_USER}
      SMTP_PASS: ${SMTP_PASS}
      FROM_EMAIL: ${FROM_EMAIL}
      APP_NAME: ${APP_NAME}

      # Gemini AI
      GEMINI_API_KEY: ${GEMINI_API_KEY}

      # Node environment
      NODE_ENV: production
    networks:
      - chitchat-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

networks:
  chitchat-network:
    driver: bridge

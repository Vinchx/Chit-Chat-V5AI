Berikut adalah langkah-langkah yang saya lakukan untuk memperbaiki typing
  indicator:

  ðŸ” 1. Identifikasi Masalah

  - selectedRoom undefined di MessageInput meskipun sudah dipilih di dashboard
  - Props tidak dikirim dari dashboard ke MessageInput component
  - Client tidak join room di socket, sehingga tidak menerima broadcast events    

  ðŸ› ï¸ 2. Perbaikan yang Dilakukan

  A. Menambahkan useRef untuk selectedRoom

  // Tambah import useRef
  import { useState, useEffect, useRef } from "react";

  // Tambah ref untuk selectedRoom
  const selectedRoomRef = useRef(null);

  // Update ref saat selectedRoom berubah
  useEffect(() => {
    selectedRoomRef.current = selectedRoom;
  }, [selectedRoom]);

  B. Update event listeners dengan room filtering

  // Sebelum: tanpa filter room
  newSocket.on("typing_start", (data) => {
    setIsTyping(true);
    setTypingUser(data.userName);
  });

  // Sesudah: dengan filter room
  newSocket.on("typing_start", (data) => {
    if (data.roomId === selectedRoomRef.current?.id) {
      setIsTyping(true);
      setTypingUser(data.userName);
    }
  });

  C. Fix props selectedRoom ke MessageInput

  // Sebelum: selectedRoom tidak dikirim
  <MessageInput
    onSendMessage={handleReceiveMessage}
    user={user}
    socket={socket}
  />

  // Sesudah: selectedRoom dikirim
  <MessageInput
    onSendMessage={handleReceiveMessage}
    user={user}
    socket={socket}
    selectedRoom={selectedRoom}  // â† Fix utama!
  />

  D. Tambah socket room joining

  // Tambah logic join room saat selectedRoom berubah
  useEffect(() => {
    if (socket && selectedRoom) {
      socket.emit("join_room", selectedRoom.id);
    }
  }, [selectedRoom, socket]);

  ðŸŽ¯ 3. Root Cause Issues

  1. Missing Props: selectedRoom tidak dikirim ke MessageInput
  2. Stale Closures: Event listeners menggunakan state lama
  3. No Room Joining: Client tidak join socket rooms
  4. No Room Filtering: Events diterima dari semua room

  ðŸ”§ 4. Debugging Tools yang Digungas

  - Console logs untuk track flow data
  - Props debugging di MessageInput
  - Server logs untuk melihat socket events
  - useRef untuk menghindari stale closures

  âœ… 5. Hasil Akhir

  Typing indicator sekarang bekerja dengan flow:
  1. User pilih room â†’ Client join socket room
  2. User ketik â†’ Emit typing_start dengan roomId
  3. Server broadcast ke room â†’ socket.to(roomId).emit()
  4. Client lain terima event â†’ Show typing indicator
  5. Auto timeout 2 detik â†’ Hide indicator

  Masalah utamanya adalah props tidak dikirim dan client tidak join room, yang    
   membuat sistem socket room-based tidak berfungsi.

import { MongoClient } from 'mongodb';

const uri = process.env.MONGODB_URI || "mongodb://127.0.0.1:27017/chitchat";

async function resetAllUsersOffline() {
    const client = new MongoClient(uri);
    
    try {
        await client.connect();
        console.log('‚úÖ Connected to MongoDB');
        
        const db = client.db();
        const users = db.collection('users');
        
        // Set all users to offline
        const result = await users.updateMany(
            {},
            { $set: { isOnline: false } }
        );
        
        console.log(`\nüîÑ Updated ${result.modifiedCount} users to offline`);
        
        // Check online count
        const onlineCount = await users.countDocuments({ isOnline: true });
        console.log(`üü¢ Online users now: ${onlineCount}`);
        
    } catch (error) {
        console.error('‚ùå Error:', error);
    } finally {
        await client.close();
        console.log('‚úÖ Connection closed\n');
    }
}

resetAllUsersOffline();
